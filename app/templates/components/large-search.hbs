<div class="large-search with-default-styling">
  <div class="search">
    <div class="search-wrapper">
      <input type="search"
             placeholder="Search for addons, maintainers and categories"
             autocomplete="off"
             id="search-input"
             spellcheck="false"
             value={{query}}
                 oninput={{action (perform this.search) value="target.value"}}>
      {{#if query}}
        <button {{action clearSearch}} class="icon-close test-clear-search"></button>
      {{/if}}
    </div>
    <div class="readme-toggle">
      {{input type="checkbox"
              class="test-search-readmes"
              id="search-readmes"
              checked=searchReadmes
              change=(action (perform this.toggleReadmeSearch))}}
      <label for="search-readmes">Search readmes</label>
    </div>
    <h6 class="no-results {{if this.hasSearchedAndNoResults 'showing'}}">No results found for "{{query}}"</h6>
  </div>

  {{#if this.results.length}}
    <h4 class="result-info test-result-info">Results for "{{query}}"</h4>
    {{#search-result-set results=this.results.displayingReadmes totalCount=this.results.totalReadmeCount fetchMore=fetchMoreReadmes title="Readmes" resultClass="readme-results"}}
      <ul class="readme-list">
        {{#each this.results.displayingReadmes as |addon|}}
          <li>
            {{addon-details addon=addon}}
            {{#each (get _results.readmeMatchMap addon.id) as |match|}}
              <div class="test-readme-match text-match">
                ...{{sanitize-html match "relaxed-with-nofollow"}}...
              </div>
            {{/each}}
          </li>
        {{/each}}
      </ul>
    {{/search-result-set}}
    {{#search-result-set results=this.results.displayingCategories totalCount=this.results.totalCategoriesCount fetchMore=fetchMoreCategories title="Categories" resultClass="category-results"}}
      <ul>
        {{#each this.results.displayingCategories as |category|}}
          <li>
            {{#link-to "categories.show" category.slug}}
              <span class="bullet">&#9632;</span>
              <div>{{category.name}} ({{category.totalAddonCount}})</div>
            {{/link-to}}
          </li>
        {{/each}}
      </ul>
    {{/search-result-set}}
    {{#search-result-set results=this.results.displayingAddons totalCount=this.results.totalAddonsCount fetchMore=fetchMoreAddons title="Addons" resultClass="addon-results"}}
      {{addon-list addons=this.results.displayingAddons}}
    {{/search-result-set}}
    {{#search-result-set results=this.results.displayingMaintainers totalCount=this.results.totalMaintainersCount fetchMore=fetchMoreMaintainers title="Maintainers" resultClass="maintainer-results"}}
      <ul>
        {{#each this.results.displayingMaintainers as |maintainer|}}
          <li>
            {{#link-to "maintainers.show" maintainer.name}}
              <span class="bullet">&#9632;</span>
              <div>{{maintainer.name}}</div>
            {{/link-to}}
          </li>
        {{/each}}
      </ul>
    {{/search-result-set}}
  {{else if this.search.isRunning}}
    {{this.dot-spinner}}
  {{/if}}
</div>
